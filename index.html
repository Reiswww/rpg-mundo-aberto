<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RPG Mundo Aberto</title>

<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-family: monospace;
  text-align: center;
}

.tela {
  display: none;
}

.ativa {
  display: block;
}

button {
  padding: 10px 20px;
  font-size: 16px;
  margin: 8px;
}

canvas {
  image-rendering: pixelated;
  border: 3px solid white;
  background: #6ab04c;
}
</style>
</head>

<body>

<div id="telaInicial" class="tela ativa">
  <h1>RPG Mundo Aberto</h1>
  <p>Pressione START</p>
  <button onclick="irParaPersonagem()">START</button>
</div>

<div id="telaPersonagem" class="tela">
  <h2>Escolha seu personagem</h2>
  <button onclick="escolher('masc')">Masculino<br>Bon√©<br>Aventureiro</button>
  <button onclick="escolher('fem')">Feminino<br>Guerreira</button>
</div>

<div id="telaJogo" class="tela">
  <canvas id="game" width="320" height="320"></canvas>
</div>

<audio id="passo" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_4a6d1d0b36.mp3"></audio>
<audio id="musica" src="https://cdn.pixabay.com/download/audio/2021/09/06/audio_7c9c0c6e1b.mp3" loop></audio>

<script>
const telas = {
  inicial: document.getElementById("telaInicial"),
  personagem: document.getElementById("telaPersonagem"),
  jogo: document.getElementById("telaJogo")
};

function trocar(t) {
  Object.values(telas).forEach(e => e.classList.remove("ativa"));
  telas[t].classList.add("ativa");
}

function irParaPersonagem() {
  trocar("personagem");
}

let personagem = "masc";

function escolher(p) {
  personagem = p;
  trocar("jogo");
  document.getElementById("musica").play();
  desenhar();
}

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const tile = 32;

const mapa = [
  [1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,1,1,1,0,0,0,1],
  [1,0,0,0,0,0,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1]
];

let player = { x: 1, y: 1 };

function desenhar() {
  ctx.clearRect(0,0,320,320);

  for (let y=0;y<mapa.length;y++){
    for (let x=0;x<mapa[y].length;x++){
      ctx.fillStyle = mapa[y][x] === 1 ? "#145a32" : "#7dcea0";
      ctx.fillRect(x*tile,y*tile,tile,tile);
    }
  }

  if (personagem === "masc") {
    ctx.fillStyle = "blue";
  } else {
    ctx.fillStyle = "pink";
  }

  ctx.fillRect(player.x*tile+8, player.y*tile+8, 16, 16);
}

document.addEventListener("keydown", e => {
  let nx = player.x;
  let ny = player.y;

  if (e.key === "ArrowUp") ny--;
  if (e.key === "ArrowDown") ny++;
  if (e.key === "ArrowLeft") nx--;
  if (e.key === "ArrowRight") nx++;

  if (mapa[ny][nx] === 0) {
    player.x = nx;
    player.y = ny;
    document.getElementById("passo").play();
  }

  desenhar();
});
</script>

</body>
</html>
